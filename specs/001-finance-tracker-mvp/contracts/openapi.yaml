openapi: 3.1.0
info:
  title: Vant - Personal Finance Tracker API
  description: API for personal finance tracking SaaS MVP
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: /api/v1
    description: API v1

tags:
  - name: Auth
    description: Authentication and user management
  - name: Accounts
    description: Financial account management
  - name: Transactions
    description: Transaction management
  - name: Categories
    description: Category management
  - name: Budgets
    description: Budget management
  - name: Dashboard
    description: Dashboard and reporting
  - name: Import
    description: CSV import operations
  - name: Notifications
    description: Notification management

paths:
  # ============ AUTH ============
  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User created, verification email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/login:
    post:
      tags: [Auth]
      summary: Login user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
        '423':
          description: Account locked (too many failed attempts)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LockedResponse'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout current user
      operationId: logout
      security:
        - sanctum: []
      responses:
        '204':
          description: Logged out successfully

  /auth/google:
    get:
      tags: [Auth]
      summary: Initiate Google OAuth
      operationId: googleRedirect
      responses:
        '302':
          description: Redirect to Google OAuth

  /auth/google/callback:
    get:
      tags: [Auth]
      summary: Google OAuth callback
      operationId: googleCallback
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
      responses:
        '302':
          description: Redirect to app with session

  /auth/verify-email/{token}:
    get:
      tags: [Auth]
      summary: Verify email address
      operationId: verifyEmail
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Email verified
        '400':
          description: Invalid or expired token

  /auth/forgot-password:
    post:
      tags: [Auth]
      summary: Request password reset
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Reset email sent (same response regardless of email existence)

  /auth/reset-password:
    post:
      tags: [Auth]
      summary: Reset password with token
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token

  /auth/user:
    get:
      tags: [Auth]
      summary: Get current user
      operationId: getCurrentUser
      security:
        - sanctum: []
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /auth/user/profile:
    patch:
      tags: [Auth]
      summary: Update profile
      operationId: updateProfile
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /auth/user/password:
    patch:
      tags: [Auth]
      summary: Change password
      operationId: changePassword
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password changed
        '422':
          $ref: '#/components/responses/ValidationError'

  # ============ ACCOUNTS ============
  /accounts:
    get:
      tags: [Accounts]
      summary: List user accounts
      operationId: listAccounts
      security:
        - sanctum: []
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Account'

    post:
      tags: [Accounts]
      summary: Create account
      operationId: createAccount
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
      responses:
        '201':
          description: Account created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '403':
          description: Account limit reached (free tier)
        '422':
          $ref: '#/components/responses/ValidationError'

  /accounts/{id}:
    get:
      tags: [Accounts]
      summary: Get account details
      operationId: getAccount
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/AccountId'
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags: [Accounts]
      summary: Update account
      operationId: updateAccount
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/AccountId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAccountRequest'
      responses:
        '200':
          description: Account updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'

    delete:
      tags: [Accounts]
      summary: Delete account
      operationId: deleteAccount
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/AccountId'
      responses:
        '200':
          description: Account deleted (with warning if had transactions)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  transactions_deleted:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  # ============ TRANSACTIONS ============
  /transactions:
    get:
      tags: [Transactions]
      summary: List transactions
      operationId: listTransactions
      security:
        - sanctum: []
      parameters:
        - name: account_id
          in: query
          schema:
            type: string
            format: uuid
        - name: category_id
          in: query
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          schema:
            type: string
            enum: [income, expense]
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          schema:
            type: string
            format: date
        - name: search
          in: query
          description: Search payee name
          schema:
            type: string
        - name: sort
          in: query
          schema:
            type: string
            enum: [date, -date, amount, -amount, payee, -payee]
            default: -date
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
      responses:
        '200':
          description: Paginated transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedTransactions'

    post:
      tags: [Transactions]
      summary: Create transaction
      operationId: createTransaction
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransactionRequest'
      responses:
        '201':
          description: Transaction created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '422':
          $ref: '#/components/responses/ValidationError'

  /transactions/transfer:
    post:
      tags: [Transactions]
      summary: Create transfer between accounts
      operationId: createTransfer
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransferRequest'
      responses:
        '201':
          description: Transfer created (returns both transactions)
          content:
            application/json:
              schema:
                type: object
                properties:
                  from_transaction:
                    $ref: '#/components/schemas/Transaction'
                  to_transaction:
                    $ref: '#/components/schemas/Transaction'

  /transactions/bulk-categorize:
    patch:
      tags: [Transactions]
      summary: Bulk re-categorize transactions
      operationId: bulkCategorize
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [transaction_ids, category_id]
              properties:
                transaction_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                category_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Transactions updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  updated_count:
                    type: integer

  /transactions/{id}:
    get:
      tags: [Transactions]
      summary: Get transaction details
      operationId: getTransaction
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/TransactionId'
      responses:
        '200':
          description: Transaction details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'

    patch:
      tags: [Transactions]
      summary: Update transaction
      operationId: updateTransaction
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/TransactionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTransactionRequest'
      responses:
        '200':
          description: Transaction updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'

    delete:
      tags: [Transactions]
      summary: Delete transaction
      operationId: deleteTransaction
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/TransactionId'
      responses:
        '204':
          description: Transaction deleted

  # ============ CATEGORIES ============
  /categories:
    get:
      tags: [Categories]
      summary: List categories
      operationId: listCategories
      security:
        - sanctum: []
      responses:
        '200':
          description: Categories (system + user custom)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Category'

    post:
      tags: [Categories]
      summary: Create custom category
      operationId: createCategory
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryRequest'
      responses:
        '201':
          description: Category created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'

  /categories/{id}:
    patch:
      tags: [Categories]
      summary: Update category
      operationId: updateCategory
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCategoryRequest'
      responses:
        '200':
          description: Category updated
        '403':
          description: Cannot modify system category

    delete:
      tags: [Categories]
      summary: Delete category
      operationId: deleteCategory
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/CategoryId'
      responses:
        '200':
          description: Category deleted, transactions reassigned
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  transactions_reassigned:
                    type: integer
                  budgets_deleted:
                    type: integer
        '403':
          description: Cannot delete protected category

  # ============ AUTO-CATEGORIZATION RULES ============
  /categories/rules:
    get:
      tags: [Categories]
      summary: List auto-categorization rules
      operationId: listRules
      security:
        - sanctum: []
      responses:
        '200':
          description: List of rules
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AutoCategorizationRule'

    post:
      tags: [Categories]
      summary: Create auto-categorization rule
      operationId: createRule
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRuleRequest'
      responses:
        '201':
          description: Rule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutoCategorizationRule'

  /categories/rules/{id}:
    patch:
      tags: [Categories]
      summary: Update rule
      operationId: updateRule
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRuleRequest'
      responses:
        '200':
          description: Rule updated

    delete:
      tags: [Categories]
      summary: Delete rule
      operationId: deleteRule
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Rule deleted

  # ============ BUDGETS ============
  /budgets:
    get:
      tags: [Budgets]
      summary: List budgets
      operationId: listBudgets
      security:
        - sanctum: []
      parameters:
        - name: year
          in: query
          schema:
            type: integer
        - name: month
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
      responses:
        '200':
          description: List of budgets with spend data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/BudgetWithSpend'

    post:
      tags: [Budgets]
      summary: Create budget
      operationId: createBudget
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBudgetRequest'
      responses:
        '201':
          description: Budget created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Budget'
        '409':
          description: Budget already exists for this category/period

  /budgets/{id}:
    patch:
      tags: [Budgets]
      summary: Update budget
      operationId: updateBudget
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/BudgetId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBudgetRequest'
      responses:
        '200':
          description: Budget updated

    delete:
      tags: [Budgets]
      summary: Delete budget
      operationId: deleteBudget
      security:
        - sanctum: []
      parameters:
        - $ref: '#/components/parameters/BudgetId'
      responses:
        '204':
          description: Budget deleted

  # ============ DASHBOARD ============
  /dashboard/summary:
    get:
      tags: [Dashboard]
      summary: Get dashboard summary
      operationId: getDashboardSummary
      security:
        - sanctum: []
      responses:
        '200':
          description: Dashboard summary data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardSummary'

  /dashboard/spending-breakdown:
    get:
      tags: [Dashboard]
      summary: Get spending by category
      operationId: getSpendingBreakdown
      security:
        - sanctum: []
      parameters:
        - name: year
          in: query
          schema:
            type: integer
        - name: month
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Spending breakdown
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpendingBreakdown'

  /dashboard/trends:
    get:
      tags: [Dashboard]
      summary: Get spending trends
      operationId: getSpendingTrends
      security:
        - sanctum: []
      parameters:
        - name: months
          in: query
          schema:
            type: integer
            default: 6
            maximum: 12
      responses:
        '200':
          description: Monthly spending trends
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpendingTrends'

  # ============ IMPORT ============
  /import/upload-url:
    post:
      tags: [Import]
      summary: Get signed URL for CSV upload
      operationId: getUploadUrl
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [filename, content_type]
              properties:
                filename:
                  type: string
                content_type:
                  type: string
                  enum: [text/csv]
      responses:
        '200':
          description: Signed upload URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_url:
                    type: string
                  file_key:
                    type: string

  /import/preview:
    post:
      tags: [Import]
      summary: Preview CSV and detect columns
      operationId: previewImport
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [file_key, account_id]
              properties:
                file_key:
                  type: string
                account_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Column preview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportPreview'

  /import/start:
    post:
      tags: [Import]
      summary: Start import with column mapping
      operationId: startImport
      security:
        - sanctum: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartImportRequest'
      responses:
        '202':
          description: Import started
          content:
            application/json:
              schema:
                type: object
                properties:
                  import_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [processing]

  /import/{id}/status:
    get:
      tags: [Import]
      summary: Get import status
      operationId: getImportStatus
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Import status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImportStatus'

  /import/{id}/duplicates:
    get:
      tags: [Import]
      summary: Get flagged duplicates
      operationId: getImportDuplicates
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Duplicate transactions
          content:
            application/json:
              schema:
                type: object
                properties:
                  duplicates:
                    type: array
                    items:
                      $ref: '#/components/schemas/DuplicateTransaction'

  /import/{id}/resolve-duplicates:
    post:
      tags: [Import]
      summary: Resolve duplicate decisions
      operationId: resolveDuplicates
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                decisions:
                  type: array
                  items:
                    type: object
                    properties:
                      row_index:
                        type: integer
                      action:
                        type: string
                        enum: [import, skip]
      responses:
        '200':
          description: Duplicates resolved

  # ============ NOTIFICATIONS ============
  /notifications:
    get:
      tags: [Notifications]
      summary: List notifications
      operationId: listNotifications
      security:
        - sanctum: []
      parameters:
        - name: unread_only
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Notification'
                  unread_count:
                    type: integer

  /notifications/{id}/read:
    patch:
      tags: [Notifications]
      summary: Mark notification as read
      operationId: markNotificationRead
      security:
        - sanctum: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Marked as read

  /notifications/read-all:
    patch:
      tags: [Notifications]
      summary: Mark all notifications as read
      operationId: markAllNotificationsRead
      security:
        - sanctum: []
      responses:
        '200':
          description: All marked as read

components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: cookie
      name: laravel_session

  parameters:
    AccountId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    TransactionId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    CategoryId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    BudgetId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
              errors:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string

  schemas:
    # ===== Auth Schemas =====
    RegisterRequest:
      type: object
      required: [email, password, display_name]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        display_name:
          type: string
          maxLength: 100

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        remember:
          type: boolean
          default: false

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        message:
          type: string

    LockedResponse:
      type: object
      properties:
        message:
          type: string
        locked_until:
          type: string
          format: date-time
        minutes_remaining:
          type: integer

    ResetPasswordRequest:
      type: object
      required: [token, email, password, password_confirmation]
      properties:
        token:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        password_confirmation:
          type: string

    UpdateProfileRequest:
      type: object
      properties:
        display_name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
        notification_preferences:
          type: object
          properties:
            budget_alerts:
              type: boolean
            email_alerts:
              type: boolean

    ChangePasswordRequest:
      type: object
      required: [current_password, password, password_confirmation]
      properties:
        current_password:
          type: string
        password:
          type: string
          minLength: 8
        password_confirmation:
          type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        display_name:
          type: string
        email_verified:
          type: boolean
        subscription_tier:
          type: string
          enum: [free, pro, team]
        notification_preferences:
          type: object
        created_at:
          type: string
          format: date-time

    # ===== Account Schemas =====
    CreateAccountRequest:
      type: object
      required: [name, type]
      properties:
        name:
          type: string
          maxLength: 100
        type:
          type: string
          enum: [checking, savings, credit_card, cash, investment]

    UpdateAccountRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100

    Account:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [checking, savings, credit_card, cash, investment]
        balance:
          type: number
          format: decimal
        currency:
          type: string
        is_asset:
          type: boolean
        created_at:
          type: string
          format: date-time

    # ===== Transaction Schemas =====
    CreateTransactionRequest:
      type: object
      required: [account_id, type, amount, date, payee]
      properties:
        account_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [income, expense]
        amount:
          type: number
          format: decimal
          minimum: 0.01
        date:
          type: string
          format: date
        payee:
          type: string
          maxLength: 255
        category_id:
          type: string
          format: uuid
        notes:
          type: string

    CreateTransferRequest:
      type: object
      required: [from_account_id, to_account_id, amount, date]
      properties:
        from_account_id:
          type: string
          format: uuid
        to_account_id:
          type: string
          format: uuid
        amount:
          type: number
          format: decimal
          minimum: 0.01
        date:
          type: string
          format: date
        notes:
          type: string

    UpdateTransactionRequest:
      type: object
      properties:
        type:
          type: string
          enum: [income, expense]
        amount:
          type: number
          format: decimal
        date:
          type: string
          format: date
        payee:
          type: string
        category_id:
          type: string
          format: uuid
        notes:
          type: string

    Transaction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        account_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        linked_transaction_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [income, expense]
        amount:
          type: number
          format: decimal
        date:
          type: string
          format: date
        payee:
          type: string
        notes:
          type: string
        category:
          $ref: '#/components/schemas/Category'
        account:
          $ref: '#/components/schemas/Account'
        created_at:
          type: string
          format: date-time

    PaginatedTransactions:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Transaction'
        meta:
          type: object
          properties:
            current_page:
              type: integer
            last_page:
              type: integer
            per_page:
              type: integer
            total:
              type: integer
            hidden_count:
              type: integer
              description: Transactions hidden due to free tier limit

    # ===== Category Schemas =====
    CreateCategoryRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        parent_id:
          type: string
          format: uuid
        icon:
          type: string
          maxLength: 50

    UpdateCategoryRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        icon:
          type: string
          maxLength: 50

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        parent_id:
          type: string
          format: uuid
        icon:
          type: string
        is_system:
          type: boolean
        is_protected:
          type: boolean
        subcategories:
          type: array
          items:
            $ref: '#/components/schemas/Category'

    # ===== Auto-Categorization Rules =====
    CreateRuleRequest:
      type: object
      required: [category_id, pattern, match_type]
      properties:
        category_id:
          type: string
          format: uuid
        pattern:
          type: string
          maxLength: 255
        match_type:
          type: string
          enum: [contains, starts_with, equals]
        priority:
          type: integer
          default: 0

    UpdateRuleRequest:
      type: object
      properties:
        category_id:
          type: string
          format: uuid
        pattern:
          type: string
        match_type:
          type: string
          enum: [contains, starts_with, equals]
        priority:
          type: integer
        is_active:
          type: boolean

    AutoCategorizationRule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        pattern:
          type: string
        match_type:
          type: string
          enum: [contains, starts_with, equals]
        priority:
          type: integer
        is_active:
          type: boolean
        category:
          $ref: '#/components/schemas/Category'

    # ===== Budget Schemas =====
    CreateBudgetRequest:
      type: object
      required: [category_id, amount, period_month, period_year]
      properties:
        category_id:
          type: string
          format: uuid
        amount:
          type: number
          format: decimal
          minimum: 0.01
        period_month:
          type: integer
          minimum: 1
          maximum: 12
        period_year:
          type: integer
        rollover_enabled:
          type: boolean
          default: false
        alert_threshold:
          type: integer
          minimum: 0
          maximum: 100
          default: 80

    UpdateBudgetRequest:
      type: object
      properties:
        amount:
          type: number
          format: decimal
        rollover_enabled:
          type: boolean
        alert_threshold:
          type: integer

    Budget:
      type: object
      properties:
        id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        amount:
          type: number
          format: decimal
        period_month:
          type: integer
        period_year:
          type: integer
        rollover_enabled:
          type: boolean
        rollover_amount:
          type: number
          format: decimal
        alert_threshold:
          type: integer
        category:
          $ref: '#/components/schemas/Category'

    BudgetWithSpend:
      allOf:
        - $ref: '#/components/schemas/Budget'
        - type: object
          properties:
            spent:
              type: number
              format: decimal
            effective_budget:
              type: number
              format: decimal
              description: amount + rollover_amount
            percent_used:
              type: number
              format: decimal
            remaining:
              type: number
              format: decimal

    # ===== Dashboard Schemas =====
    DashboardSummary:
      type: object
      properties:
        net_worth:
          type: number
          format: decimal
        total_assets:
          type: number
          format: decimal
        total_liabilities:
          type: number
          format: decimal
        current_month:
          type: object
          properties:
            income:
              type: number
              format: decimal
            expenses:
              type: number
              format: decimal
            net:
              type: number
              format: decimal
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/Account'

    SpendingBreakdown:
      type: object
      properties:
        period:
          type: object
          properties:
            month:
              type: integer
            year:
              type: integer
        total:
          type: number
          format: decimal
        categories:
          type: array
          items:
            type: object
            properties:
              category:
                $ref: '#/components/schemas/Category'
              amount:
                type: number
                format: decimal
              percentage:
                type: number
                format: decimal

    SpendingTrends:
      type: object
      properties:
        months:
          type: array
          items:
            type: object
            properties:
              month:
                type: integer
              year:
                type: integer
              label:
                type: string
              income:
                type: number
                format: decimal
              expenses:
                type: number
                format: decimal
              net:
                type: number
                format: decimal

    # ===== Import Schemas =====
    ImportPreview:
      type: object
      properties:
        columns:
          type: array
          items:
            type: string
        sample_rows:
          type: array
          items:
            type: array
            items:
              type: string
        total_rows:
          type: integer
        suggested_mapping:
          type: object
          properties:
            date:
              type: integer
            amount:
              type: integer
            payee:
              type: integer
            category:
              type: integer
            notes:
              type: integer

    StartImportRequest:
      type: object
      required: [file_key, account_id, column_mapping]
      properties:
        file_key:
          type: string
        account_id:
          type: string
          format: uuid
        column_mapping:
          type: object
          required: [date, amount, payee]
          properties:
            date:
              type: integer
            amount:
              type: integer
            payee:
              type: integer
            category:
              type: integer
            notes:
              type: integer
        date_format:
          type: string
          enum: [MM/DD/YYYY, DD/MM/YYYY, YYYY-MM-DD]
          default: MM/DD/YYYY

    ImportStatus:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, processing, completed, failed]
        total_rows:
          type: integer
        imported_count:
          type: integer
        skipped_count:
          type: integer
        error_count:
          type: integer
        duplicate_count:
          type: integer
        progress_percent:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              row:
                type: integer
              message:
                type: string

    DuplicateTransaction:
      type: object
      properties:
        row_index:
          type: integer
        imported:
          type: object
          properties:
            date:
              type: string
              format: date
            amount:
              type: number
            payee:
              type: string
        existing:
          $ref: '#/components/schemas/Transaction'

    # ===== Notification Schemas =====
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [budget_warning, budget_exceeded, import_complete, system]
        title:
          type: string
        message:
          type: string
        data:
          type: object
        read_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
